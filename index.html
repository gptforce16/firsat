<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İşletme İçi Hediye Çarkı</title>
<style>
  body{margin:0;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#0b0f14;color:#fff;}
  .wheel-container{position:relative;width:90vw;max-width:500px;}
  svg#wheel{width:100%;height:auto;transform-origin:center center;transition:transform 4s cubic-bezier(0.33,1,0.68,1);}
  .pointer{position:absolute;top:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:30px solid #06c167;}
  .spin-btn, .reset-btn{margin:10px;padding:12px 20px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;}
  .spin-btn{background:#08d47a;color:#06120a;}
  .reset-btn{background:#233246;color:#fff;}
  .qr-code{margin-top:20px;}
  .prizes-legend{margin-top:10px;}
</style>
</head>
<body>

<h2>🎁 İşletme İçi Hediye Çarkı</h2>
<div class="wheel-container">
  <div class="pointer"></div>
  <svg id="wheel" viewBox="0 0 1000 1000"></svg>
</div>
<div>
  <button class="spin-btn" id="spinBtn">Çevir</button>
  <button class="reset-btn" id="resetBtn">Sıfırla</button>
</div>
<div class="qr-code" id="qrCode"></div>
<div class="prizes-legend" id="legend"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script>
/* Ödül listesi */
const PRIZES=[
  {label:"Ücretsiz Kahve",color:"#4ade80",weight:8},
  {label:"%10 İndirim",color:"#60a5fa",weight:16},
  {label:"Tatlı İkram",color:"#f59e0b",weight:10},
  {label:"Teşekkürler 💚",color:"#94a3b8",weight:34},
  {label:"%20 İndirim",color:"#22d3ee",weight:6},
  {label:"Ücretsiz Latte",color:"#a78bfa",weight:8},
  {label:"2. İçeceğe %50",color:"#fb7185",weight:10},
  {label:"Şefin Sürprizi",color:"#34d399",weight:8}
];
const SETTINGS={dailyLimit:1,friction:0.992,minSpins:4,maxSpins:7};

/* SVG Çark Oluşturma */
const svg=document.getElementById('wheel');
const N=PRIZES.length;
const cx=500,cy=500,rOuter=480,rInner=120;
function pc(cx,cy,r,a){return {x:cx+r*Math.cos(a),y:cy+r*Math.sin(a)};}
for(let i=0;i<N;i++){
  const a0=-Math.PI/2+i*2*Math.PI/N,a1=a0+2*Math.PI/N;
  const p0=pc(cx,cy,rInner,a0),p1=pc(cx,cy,rOuter,a0),p2=pc(cx,cy,rOuter,a1),p3=pc(cx,cy,rInner,a1);
  const path=`M${p0.x},${p0.y} L${p1.x},${p1.y} A${rOuter},${rOuter} 0 0 1 ${p2.x},${p2.y} L${p3.x},${p3.y} A${rInner},${rInner} 0 0 0 ${p0.x},${p0.y} Z`;
  const slice=document.createElementNS('http://www.w3.org/2000/svg','path'); slice.setAttribute('d',path); slice.setAttribute('fill',PRIZES[i].color); slice.setAttribute('stroke','#000'); slice.setAttribute('stroke-width','2'); svg.appendChild(slice);
}

/* Legend */
const legend=document.getElementById('legend');
PRIZES.forEach(p=>{
  const div=document.createElement('div'); div.innerHTML=`<span style="display:inline-block;width:14px;height:14px;background:${p.color};margin-right:6px;"></span>${p.label}`;
  legend.appendChild(div);
});

/* Weighted Pick */
const totalWeight=PRIZES.reduce((a,b)=>a+b.weight,0);
function weightedPick(){let r=Math.random()*totalWeight; for(let i=0;i<N;i++){r-=PRIZES[i].weight; if(r<=0)return i;} return N-1;}

/* Günlük Limit */
function todayKey(){const d=new Date();return `spin:${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;}
function consumeDailyToken(){try{const k=todayKey(),used=Number(localStorage.getItem(k)||'0'); if(used>=SETTINGS.dailyLimit)return false; localStorage.setItem(k,used+1); return true;}catch(e){return true;}}

/* Spin Animasyonu */
let spinning=false,angle=0;
function spin(){
  if(spinning) return;
  if(!consumeDailyToken()){alert("Bugünlük hakkınız doldu"); return;}
  spinning=true;
  const idx=weightedPick();
  const spins=Math.floor(Math.random()*(SETTINGS.maxSpins-SETTINGS.minSpins+1))+SETTINGS.minSpins;
  const targetAngle=-(idx+0.5)*(2*Math.PI/N);
  const total=spins*2*Math.PI+targetAngle-angle%(2*Math.PI);
  let start=null;
  function animate(timestamp){
    if(!start) start=timestamp;
    const elapsed=timestamp-start;
    const t=Math.min(elapsed/3000,1);
    const ease=Math.pow(t,0.5);
    svg.style.transform=`rotate(${angle+total*ease}rad)`;
    if(t<1) requestAnimationFrame(animate); else {spinning=false;angle+=total;showQR(idx);}
  }
  requestAnimationFrame(animate);
}

/* QR Kodu */
function showQR(idx){
  const qrContainer=document.getElementById('qrCode'); qrContainer.innerHTML='';
  const qr=new QRious({element:document.createElement('canvas'),value:`${PRIZES[idx].label}-${Date.now()}`});
  qrContainer.appendChild(qr.element);
}

/* Event Listeners */
document.getElementById('spinBtn').addEventListener('click',spin);
document.getElementById('resetBtn').addEventListener('click',()=>{localStorage.removeItem(todayKey()); alert('Hakkınız sıfırlandı');});
</script>
</body>
</html>